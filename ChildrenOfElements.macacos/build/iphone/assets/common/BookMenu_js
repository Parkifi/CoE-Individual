function BookMenu(e,t){this.aboutTextContainer=t,this.menuContainer=Ti.UI.createScrollView({top:13,left:100,width:450,height:"98%",contentWidth:450,contentHeight:"auto",showVerticalScrollIndicator:!1,showHorizontalScrollIndicator:!1}),this.parseJsonDoc(e),this.menuContainer.addEventListener("selectedBook",this.selectedBookHandler),this.createLoadingScreen()}var LoaderScreen=require("/common/LoaderScreen"),FileDownloader=require("/common/FileDownloader");BookMenu.prototype.menuContainer,BookMenu.prototype.loadingScreen,BookMenu.prototype.aboutTextContainer,BookMenu.prototype.loadThumbnails=function(e){var t=this.parseDate(Ti.App.Properties.getString("lastUpdate")),i=this.parseDate(this.jsonData.lastUpdate.toString());if(i.getTime()>=t.getTime()){for(var n=[],o=0;this.jsonData.data.length>o;o++){var r="en"==Alloy.Globals.userLanguage?this.jsonData.data[o].thumb_en:this.jsonData.data[o].thumb_es;if(this.jsonData.data[o].slideshow)for(var a=0;this.jsonData.data[o].slideshow.length>a;a++)n.push("bookshelfData/"+this.jsonData.data[o].slideshow[a]);n.push("bookshelfData/"+r)}var s=new FileDownloader;s.setLoaderScreen(this.loadingScreen);var l=s.makeQueue(n,"bookshelfData");s.downloadMultiFile(l,function(){},function(){e(i)}),s=null,n=null,l=null,r=null}else e()},BookMenu.prototype.getTable=function(){return this.menuContainer},BookMenu.prototype.parseJsonDoc=function(){var e="bookshelfData/north_menu.json",t=Titanium.Filesystem.getFile(Titanium.Filesystem.applicationCacheDirectory,e),i=t.read();""==i.text?(Ti.API.info("error reading JSON file for menu"),this.jsonData=!1):(Ti.API.info("here now error reading JSON file for menu"),this.jsonData=JSON.parse(i.text),this.jsonData.popUpMessage&&(this.aboutTextContainer.text=this.jsonData.popUpMessage))},BookMenu.prototype.populateTable=function(){for(var e=75,t=0;this.jsonData.data.length>t;t++){var i="en"==Alloy.Globals.userLanguage?Titanium.Filesystem.applicationCacheDirectory+"bookshelfData/"+this.jsonData.data[t].thumb_en:Titanium.Filesystem.applicationCacheDirectory+"bookshelfData/"+this.jsonData.data[t].thumb_es,n=Ti.UI.createImageView({width:451,height:597,top:e,image:i});0==t%2?n.left=0:(n.left=226,e+=298),n.bookData=this.jsonData.data[t],n.addEventListener("click",function(e){var t={bookData:e.source.bookData};e.source.getParent().fireEvent("selectedBook",t);var i=Ti.Media.createSound({url:"/audio/fx/click2-bookselection.mp3"});i.play()}),this.menuContainer.add(n)}},BookMenu.prototype.selectedBookHandler=function(e){var t={bookData:e.bookData};e.source.getParent().fireEvent("showBookDetails",t)},BookMenu.prototype.createLoadingScreen=function(){var e=new LoaderScreen;this.loadingScreen=e.getLoader()},BookMenu.prototype.getDefaultMesage=function(){var e="";return e="es"==Alloy.Globals.userLanguage?this.jsonData.defaultMessage_es:this.jsonData.defaultMessage_en},BookMenu.prototype.getAboutMessage=function(){var e="";return e="es"==Alloy.Globals.userLanguage?this.jsonData.popUpMessage_es:this.jsonData.popUpMessage_en},BookMenu.prototype.clear=function(){this.menuContainer.removeEventListener("selectedBook",this.selectedBookHandler),this.menuContainer.removeAllChildren(),this.loadingScreen=null,this.menuContainer=null},BookMenu.prototype.parseDate=function(e){var t=new Date(e);if(t.getTime())return t;var i=e.split(/[- :T]/),n=new Date(i[0],i[1]-1,i[2],i[3],i[4],0);return n},module.exports=BookMenu;