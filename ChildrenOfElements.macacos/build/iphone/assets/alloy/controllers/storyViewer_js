function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(e){e.cancelBubble=!0}function t(e){"blur"==e.type&&y&&y.stopAudio(),"focus"==e.type&&y&&y.playAudio()}function i(){function t(){w=new S(y),w.setButtons(n,s),g.storyStage.add(w.init()),g.storyViewer.removeEventListener("android:back",e)}h(),y=new I(E,m),g.storyViewer.add(y.loadingScreen),y.loadContent(t);var i=g.speech,o=g.audio,r=g.hints,n=g.back,s=g.next;y.setButtons(i,o,r),g.anchor.active=!1}function o(){c(1),y.cleanAudio(),w.next()}function r(){c(1),y.cleanAudio(),w.back()}function n(){if(k){g.audio.active?(y.playAudio(),g.audio.active=!1,g.audio.backgroundImage="/menu/button_sound.png",Ti.App.Properties.setString("storyAudioStatus","enabled")):(y.stopAudio(),g.audio.active=!0,g.audio.backgroundImage="/menu/button_sound_off.png",Ti.App.Properties.setString("storyAudioStatus","disabled"));var e=Ti.Media.createSound({url:"/audio/fx/click1_topmenu.mp3"});e.play(),e=null,d()}}function s(){if(k){g.speech.active?(y.playSpeech(),g.speech.active=!1,g.speech.backgroundImage="/menu/button_speech.png",Ti.App.Properties.setString("speechAudioStatus","enabled")):(y.pauseSpeech(),g.speech.active=!0,g.speech.backgroundImage="/menu/button_speech_off.png",Ti.App.Properties.setString("speechAudioStatus","disabled"));var e=Ti.Media.createSound({url:"/audio/fx/click1_topmenu.mp3"});e.play(),e=null,d()}}function a(){if(k){g.hints.active?(y.hideHint(),g.hints.active=!1):(y.showHint(),g.hints.active=!0);var e=Ti.Media.createSound({url:"/audio/fx/click1_topmenu.mp3"});e.play(),e=null,d()}}function l(){if(k){g.anchor.active?c():u();var e=Ti.Media.createSound({url:"/audio/fx/click1_topmenu.mp3"});e.play(),e=null,d()}}function u(){var e=Ti.UI.createAnimation({top:0,curve:Ti.UI.ANIMATION_CURVE_EASE_IN_OUT,duration:600});g.menuElements.animate(e),g.anchor.active=!0,g.navBar.touchEnabled=!0,"number"==typeof x&&clearTimeout(x),x=setTimeout(function(){c()},1e4)}function c(e){var t=Ti.UI.createAnimation({top:-200,curve:Ti.UI.ANIMATION_CURVE_EASE_IN_OUT,duration:500});e&&(t.duration=1),g.menuElements.animate(t),g.anchor.active=!1,g.hints.active=!1,g.navBar.touchEnabled=!1,"number"==typeof x&&clearTimeout(x)}function d(){k=!1,T=setTimeout(function(){k=!0,clearTimeout(T)},1e3)}function h(){Ti.App.Properties.getString("storyAudioStatus")||Ti.App.Properties.setString("storyAudioStatus","enabled"),Ti.App.Properties.getString("speechAudioStatus")||Ti.App.Properties.setString("speechAudioStatus","enabled"),"disabled"==Ti.App.Properties.getString("storyAudioStatus")&&(g.audio.active=!1,g.audio.backgroundImage="/menu/button_sound_off.png"),"disabled"==Ti.App.Properties.getString("speechAudioStatus")&&(g.speech.active=!1,g.speech.backgroundImage="/menu/button_speech_offpng")}function p(){var e=Ti.Media.createSound({url:"/audio/fx/click1_topmenu.mp3"});e.play(),e=null,Ti.App.Properties.setString("storyAudioStatus","enabled"),Ti.App.Properties.setString("speechAudioStatus","enabled"),g.storyStage.removeAllChildren(),g.storyViewer.removeEventListener("open",i),y.cleanAudio(),y.clean(),w.clean(),y=null,w=null,g.storyViewer.close()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="storyViewer",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var g=this,f={},v={};g.__views.storyViewer=Ti.UI.createWindow({backgroundColor:"#ffffff",id:"storyViewer"}),g.__views.storyViewer&&g.addTopLevelView(g.__views.storyViewer),g.__views.storyStage=Ti.UI.createView({id:"storyStage"}),g.__views.storyViewer.add(g.__views.storyStage),g.__views.navBar=Ti.UI.createView({height:110,top:0,id:"navBar"}),g.__views.storyViewer.add(g.__views.navBar),g.__views.menuElements=Ti.UI.createView({height:110,top:-160,width:530,id:"menuElements"}),g.__views.navBar.add(g.__views.menuElements),g.__views.speech=Ti.UI.createView({left:7,top:0,width:108,height:95,backgroundImage:"/menu/button_speech.png",id:"speech"}),g.__views.menuElements.add(g.__views.speech),s?g.__views.speech.addEventListener("click",s):v["$.__views.speech!click!toggleSpeech"]=!0,g.__views.audio=Ti.UI.createView({left:115,top:0,width:98,height:97,backgroundImage:"/menu/button_sound.png",id:"audio"}),g.__views.menuElements.add(g.__views.audio),n?g.__views.audio.addEventListener("click",n):v["$.__views.audio!click!toggleAudio"]=!0,g.__views.hints=Ti.UI.createView({top:0,left:318,width:110,height:99,backgroundImage:"/menu/button_hints.png",id:"hints"}),g.__views.menuElements.add(g.__views.hints),a?g.__views.hints.addEventListener("click",a):v["$.__views.hints!click!toggleHints"]=!0,g.__views.home=Ti.UI.createView({top:0,left:419,width:98,height:93,backgroundImage:"/menu/bookshelf_navigator_home.png",id:"home"}),g.__views.menuElements.add(g.__views.home),p?g.__views.home.addEventListener("click",p):v["$.__views.home!click!exitStory"]=!0,g.__views.back=Ti.UI.createView({left:0,top:-200,width:107,height:99,backgroundImage:"/menu/button_prev.png",id:"back",zIndex:"100"}),g.__views.storyViewer.add(g.__views.back),r?g.__views.back.addEventListener("click",r):v["$.__views.back!click!back"]=!0,g.__views.next=Ti.UI.createView({right:0,top:0,width:110,height:100,backgroundImage:"/menu/button_next.png",id:"next",zIndex:"100"}),g.__views.storyViewer.add(g.__views.next),o?g.__views.next.addEventListener("click",o):v["$.__views.next!click!next"]=!0,g.__views.anchor=Ti.UI.createView({top:0,width:109,height:98,backgroundImage:"/menu/button_anchor.png",id:"anchor",zIndex:"100"}),g.__views.storyViewer.add(g.__views.anchor),l?g.__views.anchor.addEventListener("click",l):v["$.__views.anchor!click!toggleMenu"]=!0,f.destroy=function(){},_.extend(g,g.__views);var m,b=require("com.onecowstanding.flurry");b.debugLogEnabled=!0,b.eventLoggingEnabled=!0,b.sessionReportsOnCloseEnabled=!0,b.sessionReportsOnPauseEnabled=!0,b.sessionReportsOnActivityChangeEnabled=!0,b.secureTransportEnabled=!1,b.logPageView(),_flurryAudioCounter=0,_flurrySpeechCounter=0,_flurryNextCounter=0,_flurryPreviousCounter=0,_flurryNextCounter=0;var y,w,T,A=arguments[0]||{},E=A.storyID,I=require("/common/StoryBuilder"),S=require("/common/StoryNavigator"),k=!0;g.storyViewer.addEventListener("android:back",e),g.storyViewer.addEventListener("open",i),g.storyViewer.addEventListener("blur",t),g.storyViewer.addEventListener("close",t),g.storyViewer.addEventListener("focus",t),g.storyViewer.addEventListener("open",t);var x;v["$.__views.speech!click!toggleSpeech"]&&g.__views.speech.addEventListener("click",s),v["$.__views.audio!click!toggleAudio"]&&g.__views.audio.addEventListener("click",n),v["$.__views.hints!click!toggleHints"]&&g.__views.hints.addEventListener("click",a),v["$.__views.home!click!exitStory"]&&g.__views.home.addEventListener("click",p),v["$.__views.back!click!back"]&&g.__views.back.addEventListener("click",r),v["$.__views.next!click!next"]&&g.__views.next.addEventListener("click",o),v["$.__views.anchor!click!toggleMenu"]&&g.__views.anchor.addEventListener("click",l),_.extend(g,f)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;